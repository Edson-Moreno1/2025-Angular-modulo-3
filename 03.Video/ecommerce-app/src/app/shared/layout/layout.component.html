<!-- Header Principal -->
<header class="main-header">
  <!-- Mobile Header -->
  <div class="header-mobile">
    <!-- Mobile Top Bar -->
    <div class="mobile-top-bar">
      <!-- Mobile Menu Button -->
      <button class="mobile-menu-button" (click)="toggleMobileMenu()" [class.active]="showMobileMenu">
        <ui-icon name="menu" [size]="24"></ui-icon>
      </button>

      <!-- Logo Mobile -->
      <div class="logo-section-mobile">
        <a routerLink="/" class="logo">
          <span class="logo-text">eShop</span>
        </a>
      </div>

      <!-- Mobile User & Cart -->
      <div class="mobile-actions">
        <ui-theme-toggle></ui-theme-toggle>
        <ui-cart-button [count]="0" [showLabel]="false"></ui-cart-button>
      </div>
    </div>

    <!-- Mobile Search -->
    <div class="mobile-search">
      <ui-search-bar [query]="searchQuery" (search)="onSearch($event)" placeholder="Buscar productos...">
      </ui-search-bar>
    </div>
  </div>

  <!-- Desktop Header -->
  <div class="header-desktop">
    <!-- Barra superior -->
    <div class="header-top">
      <!-- Logo -->
      <div class="logo-section">
        <a routerLink="/" class="logo">
          <span class="logo-text">eShop</span>
          <span class="logo-subtitle">.com</span>
        </a>
      </div>

      <!-- Buscador -->
      <div class="search-section">
        <ui-search-bar [query]="searchQuery" (search)="onSearch($event)" placeholder="Buscar productos...">
        </ui-search-bar>
      </div>

      <!-- Área de usuario -->
      <div class="user-section">
        <!-- Theme Toggle -->
        <ui-theme-toggle></ui-theme-toggle>

        <!-- Botón de usuario -->
        <ui-dropdown menuClass="right" [isOpen]="showUserMenu" (openChange)="showUserMenu = $event">

          <div slot="trigger" class="user-info"
            [attr.aria-label]="user ? 'Menú de usuario: ' + user.displayName : 'Iniciar sesión o crear cuenta'">
            @if (user) {
            <span class="user-greeting">Hola, {{ user.displayName }}</span>
            <span class="user-account">Cuenta y Listas</span>
            } @else {
            <span class="user-greeting">Hola, Inicia sesión</span>
            <span class="user-account">Cuenta y Listas</span>
            }
          </div>

          <div slot="content" role="menu">
            @if (!user) {
            <!-- Usuario no logueado -->
            <div class="auth-section" role="group" aria-labelledby="auth-heading">
              <h3 id="auth-heading" class="sr-only">Opciones de autenticación</h3>

              <div class="auth-welcome">
                <span class="auth-title">¡Bienvenido!</span>
                <span class="auth-subtitle">Accede a tu cuenta para una mejor experiencia</span>
              </div>

              <ui-button variant="primary" routerLink="/auth/login" (click)="closeMenus()" role="menuitem">
                Iniciar sesión
              </ui-button>

              <div class="auth-text">
                <span>¿Nuevo cliente?</span>
                <a routerLink="/auth/register" (click)="closeMenus()" role="menuitem">Empieza aquí</a>
              </div>
            </div>
            <hr class="dropdown-divider" role="separator">
            }

            @if (user) {
            <!-- Usuario logueado -->
            <div class="user-links">
              <a href="#" class="dropdown-link">Tu cuenta</a>
              <a href="#" class="dropdown-link">Tus pedidos</a>
              <a href="#" class="dropdown-link">Lista de deseos</a>
              <div class="dropdown-divider"></div>
              <ui-button variant="danger" (click)="logout()">
                Cerrar sesión
              </ui-button>
            </div>
            }
          </div>
        </ui-dropdown>

        <!-- Carrito -->
        <ui-cart-button [count]="0" label="Carrito"></ui-cart-button>
      </div>
    </div>

    <!-- Barra de navegación -->
    <div class="header-nav">
      <!-- Menú de categorías -->
      <ui-dropdown [isOpen]="showCategoriesMenu" (openChange)="showCategoriesMenu = $event">

        <div slot="trigger" class="categories-trigger">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
          Todas las categorías
        </div>

        <div slot="content">
          <div class="categories-list">
            @for (category of categories; track category._id) {
            <button (click)="selectCategory(category)" class="category-item">
              {{ category.name }}
            </button>
            }
          </div>
        </div>
      </ui-dropdown>

      <!-- Enlaces de navegación adicionales -->
      <nav class="nav-links">
        <a routerLink="/deals" class="nav-link">Ofertas del día</a>
        <a routerLink="/new" class="nav-link">Novedades</a>
        <a routerLink="/bestsellers" class="nav-link">Más vendidos</a>
      </nav>
    </div>
  </div>
</header>

<!-- Mobile Menu Overlay -->
@if (showMobileMenu) {
<div class="mobile-menu-overlay" (click)="closeMobileMenu()">
</div>
}

<!-- Mobile Menu -->
@if (showMobileMenu) {
<nav class="mobile-menu active">
  <div class="mobile-menu-content">
    <!-- User Section Mobile -->
    <div class="mobile-user-section">
      @if (user) {
      <div class="mobile-user-info">
        <span class="mobile-user-name">Hola, {{ user.displayName }}</span>
      </div>
      <div class="mobile-user-links">
        <a href="#" class="mobile-menu-link" (click)="closeMobileMenu()">Tu cuenta</a>
        <a href="#" class="mobile-menu-link" (click)="closeMobileMenu()">Tus pedidos</a>
        <a href="#" class="mobile-menu-link" (click)="closeMobileMenu()">Lista de deseos</a>
        <ui-button variant="danger" (click)="logout(); closeMobileMenu()">
          Cerrar sesión
        </ui-button>
      </div>
      } @else {
      <div class="mobile-auth-section">
        <ui-button variant="primary" routerLink="/auth/login" (click)="closeMobileMenu()">
          Iniciar sesión
        </ui-button>
        <div class="mobile-auth-text">
          ¿Nuevo cliente? <a routerLink="/register" (click)="closeMobileMenu()">Empieza aquí</a>
        </div>
      </div>
      }
    </div>

    <!-- Categories Mobile -->
    <div class="mobile-categories">
      <h3 class="mobile-section-title">Categorías</h3>
      <div class="mobile-categories-list">
        @for (category of categories; track category._id) {
        <button (click)="selectCategory(category); closeMobileMenu()" class="mobile-category-item">
          {{ category.name }}
        </button>
        }
      </div>
    </div>

    <!-- Navigation Links Mobile -->
    <div class="mobile-nav-links">
      <a routerLink="/deals" class="mobile-menu-link" (click)="closeMobileMenu()">Ofertas del día</a>
      <a routerLink="/new" class="mobile-menu-link" (click)="closeMobileMenu()">Novedades</a>
      <a routerLink="/bestsellers" class="mobile-menu-link" (click)="closeMobileMenu()">Más vendidos</a>
    </div>
  </div>
</nav>
}

<!-- Overlay para cerrar menús -->
@if (showUserMenu || showCategoriesMenu) {
<div class="menu-overlay" (click)="closeMenus()">
</div>
}

<!-- Contenido principal -->
<main class="main-content">
  <router-outlet></router-outlet>
</main>

<!-- Footer básico -->
<footer class="main-footer">
  <div class="footer-content">
    <p>&copy; 2025 eShop - Todos los derechos reservados</p>
  </div>
</footer>